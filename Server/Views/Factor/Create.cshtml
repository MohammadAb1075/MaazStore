@model Domain.Factors.Factor

@{
    ViewData["Title"] = "Create";
    var ProductList = ViewBag.ProductList;
     ViewData["ProductList"] = ViewBag.ProductList;
}

<form method="post" asp-action="Create" enctype="multipart/form-data" onsubmit="return ValidateForm()">
    <div class="row">
		<div class="col-12 p-3 col-md-10 offset-md-1 p-md-5 bg-light border border-2 rounded-3 shadow-lg">
			<legend>
				فاکتور جدید
			</legend>

			<hr />
            <div clas="row">
                <div class="col-12">
        			<div class="mb-3">
				<label asp-for="CustomerName" class="form-label"></label>
				<input asp-for="CustomerName" class="form-control" />
				<span asp-validation-for="CustomerName" class="text-danger"></span>
			        </div>

			        <div class="mb-3">
				        <label asp-for="Description" class="form-label"></label>
				        <textarea asp-for="Description" class="form-control"></textarea>
				        <span asp-validation-for="Description" class="text-danger"></span>
			        </div>
                </div>

                <div class="col-12 ml-5">
                    <table id="CodesTable" class="table table-borderless table-sm mb-0 pb-0">
                        <thead>
                            <tr>
                                <th>Product</th>  
                                <th>Quantity</th>  
                                <th>UnitPrice</th>  
                                <th>Discount</th>  
                                <th>DiscountedUnitPrice</th>  
                                <th>RowPriceTotal</th>  
                                <th>DiscountedRowPriceTotal</th>
                                <th>CustomerProfitUnitDiscount</th>
                                <th>CustomerProfitTotalDiscount</th>
                                <th style="width:60px;">
                                    <button id='btnAddDetailRow' type="button" class="btn btn-sm btn-secondary visible" onclick="AddItem(this)">
                                        Add
                                    </button>
                                </th>
                            </tr>
                        </thead>

                        <tbody>
                            @for(int i = 0; i < Model.FactorRows.Count; i++){
                                var factorRow = @Model.FactorRows[i];
                                var product = factorRow.Product;
                                <tr>
                                <td>
                                    <select asp-for="@(product.Name)" class="form-control form-control-sm form-control-plaintext" asp-items="@ProductList">
                                    </select>
                                </td>
                                <td>
                                    <input asp-for="@factorRow.Quantity"  class="form-control form-control-sm form-control-plaintext"/>
                                </td>
                                <td>
                                    <input asp-for="@product.UnitPrice"  class="form-control form-control-sm form-control-plaintext" readonly/>
                                </td>
                                <td>
                                    <input asp-for="@factorRow.Discount"  class="form-control form-control-sm form-control-plaintext"/>
                                </td>
                                <td>
                                    <input asp-for="@factorRow.DiscountedUnitPrice"  class="form-control form-control-sm form-control-plaintext" readonly/>
                                </td>
                                <td>
                                    <input asp-for="@factorRow.RowPriceTotal"  class="form-control form-control-sm form-control-plaintext" readonly/>
                                </td>
                                <td>
                                    <input asp-for="@factorRow.DiscountedRowPriceTotal"  class="form-control form-control-sm form-control-plaintext" readonly/>
                                </td>
                                <td>
                                    <input asp-for="@factorRow.CustomerProfitUnitDiscount"  class="form-control form-control-sm form-control-plaintext" readonly/>
                                </td>
                                <td>
                                    <input asp-for="@factorRow.CustomerProfitTotalDiscount"  class="form-control form-control-sm form-control-plaintext" readonly/>
                                </td>
                                <td style="width:60px;">
                                    <button id='btnremove-@i' type="button" class="btn btn-sm btn-danger visible" onclick="DeleteItem(this)">
                                        Delete
                                    </button>
                                </td>
                            </tr>
                            }   
                        </tbody>
                    </table>
                </div>
            </div>



			<button type="submit" class="btn btn-primary">ایجاد</button>
			<button type="reset" class="btn btn-secondary">Reset</button>
		
    
        </div>
	</div>
</form>



        

@section Scripts {
    @{await Html.RenderPartialAsync("PartialViews/_ValidationScriptsPartial");} 

    <script>
      function DeleteItem(btn) {
       $(btn).closest('tr').remove();
      }

      function AddItem(btn) {

       var table = document.getElementById('ExpTable');
       var rows = table.getElementsByTagName('tr');

       var rowOuterHtml = rows[rows.length - 1].outerHTML;

       var lastrowIdx = document.getElementById('hdnLastIndex').value;

       var nextrowIdx = eval(lastrowIdx) + 1;

       document.getElementById('hdnLastIndex').value = nextrowIdx;

       rowOuterHtml = rowOuterHtml.replaceAll('_' + lastrowIdx + '_', '_' + nextrowIdx + '_');
       rowOuterHtml = rowOuterHtml.replaceAll('[' + lastrowIdx + ']', '[' + nextrowIdx + ']');
       rowOuterHtml = rowOuterHtml.replaceAll('-' + lastrowIdx, '-' + nextrowIdx);


       var newRow = table.insertRow();
       newRow.innerHTML = rowOuterHtml;



       var btnAddID = btn.id;
       var btnDeleteid = btnAddID.replaceAll('btnadd', 'btnremove');

       var delbtn = document.getElementById(btnDeleteid);
       delbtn.classList.add("visible");
       delbtn.classList.remove("invisible");


       var addbtn = document.getElementById(btnAddID);
       addbtn.classList.remove("visible");
       addbtn.classList.add("invisible");

      }
    </script>
}
